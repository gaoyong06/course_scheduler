
最近在做课程表的排课，涉及很复杂的计算，有没有算法大牛能给点建议或者提示吗？

下面是排课的要求：

**九年级，14个班，周一至周五，上午4节课，下午4节课，周一下午第4节统一班会课**

**每个班**：

* 语文7节（两次两节课的连堂，排在周二和周四）
* 数学7节（一次两节课的连堂，排在周三）
* 英语6节（两次两节课的连堂，排在周三和周五，周二正课没有英语）
* 物理5节（一次两节课的连堂）
* 化学5节（一次两节课的连堂）
* 道法4节（一次两节课的连堂）
* 历史4节（一次两节课的连堂）
* 物理化学每天至少1节课，包括晚自习


**任课方案**：

* 语文1: 1-2班 语文2: 3-4班 语文3: 5-6班 语文4: 7-8班 语文5: 9-10班 语文6: 11-12班 语文7: 13-14班
* 数学1: 1-2班 数学2: 3-4班 数学3: 5-6班 数学4: 7-8班 数学5: 9班 数学6: 10班 数学7: 11-12班 数学8: 13-14班
* 英语1: 1-2班 英语2: 3-4班 英语3: 5-6班 英语4: 7-8班 英语5: 9-10班 英语6: 11-12班 英语7: 13-14班
* 物理1: 1-3班 物理2: 4-6班 物理3: 7-9班 物理4: 10-11班 物理5: 12-14班
* 化学1: 1-3班 化学2: 4-5班 化学3: 6-8班 化学4: 9-11班 化学5: 12-14班
* 道法1: 1-4班 道法2: 5-8班 道法3: 9-10班 道法4: 11-14班
* 历史1: 1-4班 历史2: 5-9班 历史3：10-14班

---

为了表达方便，我对问题做了一些简化，我查看了一些资料，现在使用遗传算法来解决这个问题，下面是我现在的数据结构：

**背景信息**：

* 教学任务：1年级1班,一周有1节语文课, 1节数学课；1年级2班,一周有1节语文课, 1节数学课
* 教师：王老师：教授 1年级1班和1年级2班语文；李老师：教授 1年级1班和1年级2班数学
* 时间段：每周5天,每天8节课, 一周就是40个时间段, 用数组表示：[1,2,3....40]

**数据结构**：

* 基因：科目+班级+教师+时间段
* 时间段：例如每周5天,每天8节课, 一周就是40个时间段
* 染色体：相同科目,相同班级组成的多个基因组成的数组
* 个体：多个染色体组成的数组

**个体,染色体,基因数据结构举例**：

* 基因：
	+ 基因1:  语文(科目)+1年级1班(班级)+王老师(教师)+1(时间段, 1是举例, 可以是1...40中的任意一个数字)
	+ 基因2:  ...
* 染色体：
	+ 染色体1：
		- 基因1:  语文(科目)+1年级1班(班级)+王老师(教师)+1(时间段)
	+ 染色体2：
		- 基因1:  数学(科目)+1年级1班(班级)+李老师(教师)+4(时间段)
	+ 染色体3：...
* 个体：
	+ 染色体1：
		- 基因1:  语文(科目)+1年级1班(班级)+王老师(教师)+1(时间段)
	+ 染色体2：
		- 基因1:  数学(科目)+1年级1班(班级)+李老师(教师)+4(时间段)
	+ 染色体3：
		- 基因1:  语文(科目)+1年级2班(班级)+王老师(教师)+7(时间段)
	+ 染色体4：
		- 基因1:  数学(科目)+1年级2班(班级)+李老师(教师)+10(时间段)

**现在的做法是**：

现在两个个体交叉操作时，是在种群中随机找到两个父代个体中的一个染色体索引位置,然后做交叉(相互交换索引位置前后的染体)，生成两个子代。这样交叉后，会出现时间段冲突(会有相同的时间段)：个体内部的同一个班级内，出现了相同的时间段，个体内部的同一个教师内，出现了相同的时间段。这就不对了，因为同一个班级，在同一个时间段，没法上两节不同的课，同一个教师，在同一个时间段，也没法上两节课。

**现在的解决方法是**：

通过一个修复函数来处理这种冲突，思路是：交叉操作后，将班级内冲突时间段，都整理到一起，将班级内还可以使用的时间段，也整理到一起；然后将教师的冲突时间段，也整理到一起，将教师还可以使用的时间段，也整理到一起；然后将班级冲突时间段，和教室冲突时间段，通过班级可用时间段和教师时间段来替换。如果将班级冲突时间段，和教室冲突时间段，都能使用班级可用时间段和教师时间段替换调，则表示修复成功，反之就是无法修复。

但是现在是会出现，无法修复的情况，如果无法修复，那么就需要撤销此次交叉操作。实际情况是，能实际修复的交叉操作很少，导致迭代很多代后，最优的个体，还是第1代的，这就不对了。

**现在的问题是**：

应该如何执行交叉操作，才能避免同一个班级（如：1年级1班），在交叉后，出现时间段冲突；才能避免同一个教师（如：王老师），在交叉后，出现时间段冲突；后续可能还有教学场地冲突等等...

请问该如何处理更好一些？
